function e(e,i){for(var t=0;i.length>t;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function i(){var e=this;this._id=void 0,this._onMessage=void 0,this._onPreviewReady=void 0,this._prevData=void 0,this._messageReceiver=function(i){if("__preview_soc_birdge_key__"===i.key){var t=JSON.parse(i.newValue||"");if(e._id&&(null==t?void 0:t.id)===e._id)switch(t.type){case 4097:e.sendMessage(e._prevData),e._onPreviewReady&&e._onPreviewReady();break;case 4098:e._onMessage&&e._onMessage(t.data)}}},this.sendMessage=function(i){e._prevData=i,window.localStorage.setItem("__preview_soc_birdge_key__",JSON.stringify({id:e._id,type:4098,data:i}))},this.bind=function(i){e._id=i,window.removeEventListener("storage",e._messageReceiver,!1),window.addEventListener("storage",e._messageReceiver,!1)},this.ready=function(){e._id?window.localStorage.setItem("__preview_soc_birdge_key__",JSON.stringify({id:e._id,type:4097})):console.log("%c ready failed. you need bind id first, use: soc.bind(id as your id)","background: red")},this.destory=function(){e._id=null,window.removeEventListener("storage",e._messageReceiver,!1)},this._id=null,this._onMessage=null,this._onPreviewReady=null,this._prevData=null}var t,n,s;return t=i,(n=[{key:"onMessage",get:function(){return this._onMessage},set:function(e){this._onMessage=e}},{key:"onPreviewReady",get:function(){return this._onPreviewReady},set:function(e){this._onPreviewReady=e}}])&&e(t.prototype,n),s&&e(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}();export{i as default};
