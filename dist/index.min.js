!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).StorageSock=i()}(this,(function(){"use strict";function e(e,i){for(var t=0;i.length>t;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i="__preview_soc_birdge_key__";return function(){function t(){var e=this;this._id=void 0,this._onMessage=void 0,this._onPreviewReady=void 0,this._prevData=void 0,this._messageReceiver=function(t){if(t.key===i){var n=JSON.parse(t.newValue||"");if(e._id&&(null==n?void 0:n.id)===e._id)switch(n.type){case 4097:e.sendMessage(e._prevData),e._onPreviewReady&&e._onPreviewReady();break;case 4098:e._onMessage&&e._onMessage(n.data)}}},this.sendMessage=function(t){e._prevData=t,window.localStorage.setItem(i,JSON.stringify({id:e._id,type:4098,data:t}))},this.bind=function(i){e._id=i,window.removeEventListener("storage",e._messageReceiver,!1),window.addEventListener("storage",e._messageReceiver,!1)},this.ready=function(){e._id?window.localStorage.setItem(i,JSON.stringify({id:e._id,type:4097})):console.log("%c ready failed. you need bind id first, use: soc.bind(id as your id)","background: red")},this.destory=function(){e._id=null,window.removeEventListener("storage",e._messageReceiver,!1)},this._id=null,this._onMessage=null,this._onPreviewReady=null,this._prevData=null}var n,o,s;return n=t,(o=[{key:"onMessage",get:function(){return this._onMessage},set:function(e){this._onMessage=e}},{key:"onPreviewReady",get:function(){return this._onPreviewReady},set:function(e){this._onPreviewReady=e}}])&&e(n.prototype,o),s&&e(n,s),Object.defineProperty(n,"prototype",{writable:!1}),t}()}));
