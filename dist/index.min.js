!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).StorageSock=i()}(this,(function(){"use strict";function e(e,i){for(var t=0;i.length>t;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=700001,t=700002,n="__preview_soc_birdge_key__";return function(){function s(){var e=this;this._id=void 0,this._onMessage=void 0,this._onPreviewReady=void 0,this._prevData=void 0,this._messageReceiver=function(s){if(s.key===n){var o=JSON.parse(s.newValue||"{}");if(!e._id||(null==o?void 0:o.id)!==e._id)switch(o.type){case i:e.sendMessage(e._prevData),e._onPreviewReady&&e._onPreviewReady();break;case t:e._onMessage&&e._onMessage(o.data)}}},this.setData=function(i,t){window.localStorage.setItem(n,JSON.stringify({id:e._id,type:i,data:t}))},this.sendMessage=function(i){e._prevData=i,e.setData(t,i)},this.bind=function(i){e._id=i,window.removeEventListener("storage",e._messageReceiver,!1),window.addEventListener("storage",e._messageReceiver,!1)},this.ready=function(){e._id?e.setData(i):console.error("ready failed. you need bind id first, use: soc.bind(id as your id)")},this.destory=function(){e._id=null,window.removeEventListener("storage",e._messageReceiver,!1)},this._id=null,this._onMessage=null,this._onPreviewReady=null,this._prevData=null}var o,a,r;return o=s,(a=[{key:"onMessage",get:function(){return this._onMessage},set:function(e){this._onMessage=e}},{key:"onPreviewReady",get:function(){return this._onPreviewReady},set:function(e){this._onPreviewReady=e}}])&&e(o.prototype,a),r&&e(o,r),Object.defineProperty(o,"prototype",{writable:!1}),s}()}));
